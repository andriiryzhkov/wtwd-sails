# Приклад курсового проекту/роботи з дисципліни "Веб-технології та веб-дизайн"

В якості прикладу буде створено веб-додаток для замовлення комунальних послуг. Передбачається реалізація можливості розмістити замовлення від клієнта для виконання певного виду комунальної послуги (погалодження електрики, прочистака каналізації, тощо). Клієнт при замовленні вибирає тип послуги та описує суть проблеми, яку необхідно вирішити. В процесі обслуговування, клієнт та виконавець можуть обмінуватись повідомленнями для уточнення ситуації. Виконане замовлення відповідно помічається.

## Системні вимоги

- [Node.js](https://nodejs.org/)
- [MySQL Server](https://www.mysql.com/products/community/)

Sails.js потребує нативної компіляції деяких пакетів, тому додатково треба встановити:

- [Python 2.7](https://www.python.org/download/releases/2.7/)
- [Visual Studio Community 2015 Edition](https://www.visualstudio.com/) (Вибіркова установка, виберіть Visual C++ під час установки)

## 1 Створіть каркас проекту

Для реалізації серверної частини скористаємость додатком [Sails.js](http://sailsjs.org) на платформі Node.js. Для встановлення останньої стабільної версії виконайте в командному рядку:

```
npm -g install sails
```

Новий проект створюється командою

```
sails new wtwd-sails
```

## 2 Створіть модель бази даних

Для створення моделі скористайтесь програмою [MySQL Workbench](http://dev.mysql.com/downloads/workbench/).

## 3 Перевірте модель бази даних на відповідність нормальним формам

Корисна стаття щодо нормалізації на Хабрахабр [Нормализация отношений. Шесть нормальных форм](http://habrahabr.ru/post/254773/)

Також корисно:
* [Руководство по проектированию реляционных баз данных](http://habrahabr.ru/post/193136/)
* [Описание основных приемов нормализации базы данных](https://support.microsoft.com/ru-ru/kb/283878)

## 4 Експортуйте модель у SQL-скрипт

Засіб для експорту моделі в SQL-скрипт знаходиться в меню MySQL Workbench: File - Export - Forward Engineer SQL CREATE Script.

## 5 Створіть базу даних

Маючи SQL-скрипт ви можете створити базу даних. Також можливе пряме створення бази даних з моделі. Для цього в меню MySQL Workbench скористайтесь командою: Database - Forward Engineer.

## 6 Стартові налаштування та генерація моделей серверної частини

Стартові налаштування включають параметри підключення до бази даних та деякі параметри функціонування sails. Дивіться відповідний commit для деталей.

Базові API серверної частини, які включають моделі та контролери генеруються задопомогою команд:

```
sails generate api user
sails generate api order
sails generate api type
sails generate api message
```

## 7 Створення моделей даних

На попередньому кроці були згенеровані наступні файли моделей даних нашого веб-додатку:

```
api/models/Message.js
api/models/Order.js
api/models/Type.js
api/models/User.js
```

Одразу після генерації вони практично порожні. Наприклад, модель User виглядає так:

```
module.exports = {

  attributes: {

  }
};
```

Нам слід визначити модель даних в об'єкті attributes, яка точно повторює нашу базу даних. **Назва кожного атрибуту має точно відповідати кожному атрибуту таблиці бази даних!**

Документтація щодо створення атрибутів моделі наведена [тут](http://sailsjs.org/documentation/concepts/models-and-orm/attributes).

## 8 Створення механізму авторизації користувачів

В проекті реалізована проста авторизація користувачів. Для цого використовується пакет [Passport](http://passportjs.org/). Перш ніж продовжити треба встановити два нових пакети:

```
npm install --save passport passport-local
```

Наша модель користувача User вже містить необхідні дані:
- атрибут email, який використовуватиметься в якості імені користувача,
- атрибут password, відповідно, для зберігання пароля.

Зверніть увагу на доданий метод toJSON в моделі User. Цей метод перевизначає вбудований метод з метоє видалити пароль з вихідного потоку даних, тобто скрити пароль.

В контролері UserController додані методи пов'язані з процесом авторизації.

В папці `view/user` додані форми для входу та реєстрації нового користувача.

В файлі налаштувань `config/http.js` задіяно Passport в якості middleware, тобто проміного обробника запитів в sails.

Додано новий файл `config/passport.js` який містить реалізацію стратегії авторизації.

В папці `api/policy` додано два файла, які визначають політики доступу до даних. `isClient.js` перевіряє чи є користувач авторизованим, а `isManager.js` крім цього ще й перевіряє чи встановлено у користувача право на дамінітсрування (атрибут manager).

Прив'язка політик доступу до відповідних методів конролерів визначається в файлі `config/policies.js`.

В файлі `config/routes.js` додано відповідні перенаправлення запитів HTTP до методів контролерів, пов'язаних з авторизацією.

**Увага!** Для реалізації авторизації (якщо вона вам потрібна), ви можете скопіювати практично всі зміни на цьому кромі з прикладу. Перевірте відповідність логіну та паролю в файлі `config/passport.js`. Та налаштуйте політики доступу до даних в файлі `config/policies.js` відповідно до вашої задачі. Все інше можна взяти без змін.

**Ще одне важливе зауваження.** Приведений приклад авторизації є не повним з точки зору обмеження прав доступу для різних груп користувачів. Проте він є базовим, досить просто реалізується і демострує принцип авторизації користувачів.
